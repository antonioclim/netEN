# sysctl.conf — Kernel Tuning for Network Testing
# Starterkit Week 14 — Computer Networks
#
# Application: sudo sysctl -p configs/sysctl.conf
# Reset: sudo sysctl --system
#
# WARNING: These settings are for testing environments, not production!

# ============================================================================
# NETWORKING - GENERAL
# ============================================================================

# Enable IP forwarding (required for routing/NAT)
net.ipv4.ip_forward = 1

# Disable strict source validation (for asymmetric topologies)
net.ipv4.conf.all.rp_filter = 0
net.ipv4.conf.default.rp_filter = 0

# Respond to ping broadcasts (useful for network discovery in lab)
net.ipv4.icmp_echo_ignore_broadcasts = 0

# ============================================================================
# TCP TUNING
# ============================================================================

# Increase TCP buffers for better throughput
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216

# Enable TCP window scaling
net.ipv4.tcp_window_scaling = 1

# Increase connection queue (for servers with load)
net.core.somaxconn = 4096
net.ipv4.tcp_max_syn_backlog = 4096

# Reduce TIME_WAIT (useful in testing, not production!)
net.ipv4.tcp_fin_timeout = 15
net.ipv4.tcp_tw_reuse = 1

# More aggressive keepalive (for rapid detection of dead connections)
net.ipv4.tcp_keepalive_time = 60
net.ipv4.tcp_keepalive_intvl = 10
net.ipv4.tcp_keepalive_probes = 3

# ============================================================================
# UDP TUNING
# ============================================================================

# Increase UDP buffers
net.core.rmem_default = 1048576
net.core.wmem_default = 1048576

# ============================================================================
# FOR MININET
# ============================================================================

# Allow more network namespaces
# (required for large topologies)
# kernel.unprivileged_userns_clone = 1

# Increase file descriptor limit
fs.file-max = 2097152

# ============================================================================
# SECURITY (relaxed for lab)
# ============================================================================

# Accept ICMP redirects (useful in lab, disabled in production)
net.ipv4.conf.all.accept_redirects = 1
net.ipv4.conf.default.accept_redirects = 1

# Allow bind on non-local addresses (for load balancing)
net.ipv4.ip_nonlocal_bind = 1

# ============================================================================
# END
# ============================================================================
