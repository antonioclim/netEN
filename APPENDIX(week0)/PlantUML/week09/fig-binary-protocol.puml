@startuml fig-binary-protocol
'A4 Landscape
skinparam backgroundColor white
skinparam defaultFontName Arial
skinparam defaultFontSize 10
skinparam shadowing false

title Binary Protocol Message Structure

rectangle "Message Format" as msg #F5F5F5 {
    rectangle "Magic\n2B\n0xCAFE" as magic #E1BEE7
    rectangle "Version\n1B" as ver #BBDEFB
    rectangle "Type\n1B" as type #BBDEFB
    rectangle "Length\n4B" as len #C8E6C9
    rectangle "Payload\n(variable)" as payload #FFF9C4
    rectangle "Checksum\n2B" as csum #FFCDD2
    
    magic -right[hidden]-> ver
    ver -right[hidden]-> type
    type -right[hidden]-> len
    len -right[hidden]-> payload
    payload -right[hidden]-> csum
}

note bottom of msg
    Field purposes:
    * Magic: identifies protocol, sync point
    * Version: protocol version
    * Type: message type (request, response)
    * Length: payload size (network byte order)
    * Payload: actual data
    * Checksum: error detection
end note

note as N1
    Python packing example:
    import struct
    
    # Pack message
    header = struct.pack('!HBBIH',
        0xCAFE,  # magic
        1,       # version
        0x01,    # type
        len(data), # length
        checksum)
    
    # Unpack message  
    magic, ver, type, length = \
        struct.unpack('!HBBI', header[:8])
end note

