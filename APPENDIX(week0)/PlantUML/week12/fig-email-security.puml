@startuml fig-email-security
'A4 Portrait
skinparam backgroundColor white
skinparam defaultFontName Arial
skinparam defaultFontSize 10
skinparam shadowing false

title Email Authentication\nSPF, DKIM, DMARC

rectangle "SPF (Sender Policy Framework)" as spf #E3F2FD {
    note as spf_n
        DNS TXT Record:
        example.com TXT "v=spf1
          ip4:203.0.113.0/24
          include:_spf.google.com
          -all"
        
        Verifies sender IP is authorized
    end note
}

rectangle "DKIM (DomainKeys)" as dkim #E8F5E9 {
    note as dkim_n
        Email Header:
        DKIM-Signature: v=1; d=example.com;
          s=mail; h=from:to:subject;
          b=ABC123...
        
        DNS Public Key:
        mail._domainkey.example.com TXT
          "v=DKIM1; k=rsa; p=MIGf..."
        
        Verifies message integrity
    end note
}

rectangle "DMARC" as dmarc #FFF3E0 {
    note as dmarc_n
        DNS TXT Record:
        _dmarc.example.com TXT
          "v=DMARC1; p=reject;
           rua=mailto:reports@example.com"
        
        Policy: none, quarantine, reject
        Combines SPF + DKIM alignment
    end note
}

note as N1
    Authentication Flow:
    1. Receiver checks SPF
       (Is sender IP authorized?)
    2. Receiver checks DKIM
       (Is signature valid?)
    3. Receiver checks DMARC
       (Do SPF/DKIM align with From?)
    4. Apply policy
end note

