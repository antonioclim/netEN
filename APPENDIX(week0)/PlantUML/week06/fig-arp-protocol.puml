@startuml fig-arp-protocol
'A4 Portrait
skinparam backgroundColor white
skinparam defaultFontName Arial
skinparam defaultFontSize 11
skinparam shadowing false

title ARP Protocol Flow\nAddress Resolution Protocol

participant "Host A\n192.168.1.10\nAA:AA:AA:AA:AA:AA" as A
participant "Switch" as S
participant "Host B\n192.168.1.20\nBB:BB:BB:BB:BB:BB" as B

note over A
    A wants to send to B
    Checks ARP cache: miss
end note

== ARP Request (Broadcast) ==

A -> S : ARP Request (broadcast)\nWho has 192.168.1.20?\nTell 192.168.1.10

S -> B : Broadcast to all ports
S -> S : (and other hosts)

note over A, B
    ARP Request:
    Dst MAC: ff:ff:ff:ff:ff:ff
    Src MAC: AA:AA:AA:AA:AA:AA
    Target IP: 192.168.1.20
    Sender IP: 192.168.1.10
end note

== ARP Reply (Unicast) ==

B -> S : ARP Reply (unicast)\n192.168.1.20 is at BB:BB:BB:BB:BB:BB
S -> A : Forward to port

note over A
    A updates ARP cache:
    192.168.1.20 -> BB:BB:BB:BB:BB:BB
end note

== Normal Communication ==

A -> B : IP packet with correct MAC

note over A, B
    Verification:
    arp -a (show ARP cache)
    ip neigh show
    tcpdump -i eth0 arp
end note

