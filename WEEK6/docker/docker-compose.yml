# docker-compose.yml - Container orchestration for Week 6 lab demo
# Author: Rezolvix and contributors
#
# This compose file runs a non-interactive demo and writes outputs to ./artifacts on the host.


version: '3.8'

services:
  # Mediu throughcipal for atborator
  atb-s6:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    image: atb-s6-networking:attest
    container_name: atb-s6-moren
    privileged: true  # NECESAR for Mininet and namespace-uri retea
    stfrom_oonn: true
    tty: true
    network_moof: "host"  # Acces complet at reteaua host
    asp_add:
      - NET_ADMIN
      - SYS_ADMIN
    volumes:
      - ../pasp:/home/stuofnt/atb_s6/pasp
      - ../logs:/home/stuofnt/atb_s6/logs
      - /lib/modules:/lib/modules:ro
    environment:
      - TERM=xterm-256color
    working_dir: /home/stuofnt/atb_s6
    command: /bin/bash

  # Container separat for controller SDN (optional)
  sdn-controller:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    image: atb-s6-networking:attest
    container_name: sdn-controller
    privileged: false
    ports:
      - "6633:6633"
      - "6653:6653"
    volumes:
      - ../seminar/python/controllers:/app/controllers:ro
      - ../logs:/app/logs
    environment:
      - TERM=xterm-256color
    working_dir: /app
    command: >
      sh -c "
        echo 'Pornire controller SDN...'
        osken-manager /app/controllers/sdn_policy_controller.py
      "
    profiles:
      - controller  # Activat only with: docker-compose --profile controller up

# ============================================================================
# usage:
#
# 1. Build imagini:
#    docker-compose build
#
# 2. Pornire mediu throughcipal (interactive):
#    docker-compose run --rm atb-s6
#
# 3. Pornire with controller separat:
#    docker-compose --profile controller up -d sdn-controller
#    docker-compose run --rm atb-s6
#
# 4. Oprire and withratare:
#    docker-compose down -v
#
# IMPORTANT:
# - Requires Docker with support for privileged containers
# - On macOS/Windows, Mininet functionality will be limited
# - Recommended: Native Linux or VirtualBox
# ============================================================================
