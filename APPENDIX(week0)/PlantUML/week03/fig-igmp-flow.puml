@startuml fig-igmp-flow
'A4 Portrait - Sequence diagram
skinparam backgroundColor white
skinparam defaultFontName Arial
skinparam defaultFontSize 11
skinparam shadowing false

skinparam sequence {
    ArrowThickness 2
    ArrowColor #1565C0
    ParticipantBorderColor #1565C0
    ParticipantBackgroundColor #BBDEFB
}

title IGMP Protocol Flow\nMulticast group membership management

participant "Host A\n(wants to join)" as A
participant "Router\n(IGMP Querier)" as R
participant "Host B\n(already member)" as B

note over A, B
    Router maintains multicast group table
end note

== Join Process ==

A -[#43A047]> R : IGMP Membership Report\nGroup: 239.0.0.1 (Type 0x16)
note right of R #C8E6C9
    Router adds Host A
    to group 239.0.0.1
end note

== Periodic Query ==

R -[#1565C0]> A : IGMP Membership Query\nType: 0x11, Dest: 224.0.0.1
R -[#1565C0]> B : IGMP Membership Query

note over A, B #FFF9C4
    Hosts set random timer
    (0 to Max Response Time)
end note

B -[#43A047,dashed]-> R : Membership Report\nGroup: 239.0.0.1

note over A #E8F5E9
    Host A sees B's report
    Suppresses own report
    (avoids duplicates)
end note

== Leave Process ==

A -[#E53935]> R : IGMP Leave Group\nGroup: 239.0.0.1 (Type 0x17)\nDest: 224.0.0.2

R -[#1565C0]> B : Group-Specific Query\nGroup: 239.0.0.1

B -[#43A047,dashed]-> R : Membership Report

note right of R #C8E6C9
    Group still has members
    Keep forwarding traffic
end note

== Verification ==

note over A, B
    Capture IGMP:
    tcpdump -i eth0 -n igmp
    tshark -r capture.pcap -Y "igmp"
end note

@enduml
