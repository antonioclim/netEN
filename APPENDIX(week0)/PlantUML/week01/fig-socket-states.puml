@startuml fig-socket-states
skinparam backgroundColor white
skinparam defaultFontName Arial
skinparam defaultFontSize 10
skinparam shadowing false

title TCP Socket State Diagram

rectangle "Connection States" {
    rectangle "CLOSED" as CLOSED #ECEFF1
    rectangle "LISTEN" as LISTEN #C8E6C9
    rectangle "SYN_SENT" as SYN_SENT #FFF9C4
    rectangle "SYN_RCVD" as SYN_RCVD #FFF9C4
    rectangle "ESTABLISHED" as ESTAB #81C784
    rectangle "FIN_WAIT_1" as FW1 #FFE0B2
    rectangle "FIN_WAIT_2" as FW2 #FFE0B2
    rectangle "CLOSE_WAIT" as CW #FFCDD2
    rectangle "LAST_ACK" as LA #FFCDD2
    rectangle "TIME_WAIT" as TW #E1BEE7
}

CLOSED -[#1565C0]-> LISTEN : Server: bind+listen
CLOSED -[#1565C0]-> SYN_SENT : Client: connect

LISTEN -[#43A047]-> SYN_RCVD : Rcv SYN
SYN_SENT -[#43A047]-> ESTAB : Rcv SYN-ACK
SYN_RCVD -[#43A047]-> ESTAB : Rcv ACK

ESTAB -[#FF9800]-> FW1 : Send FIN
ESTAB -[#FF9800]-> CW : Rcv FIN

FW1 -[#FF9800]-> FW2 : Rcv ACK
FW2 -[#FF9800]-> TW : Rcv FIN

CW -[#E53935]-> LA : Send FIN
LA -[#E53935]-> CLOSED : Rcv ACK
TW -[#E53935]-> CLOSED : Timeout

note bottom of ESTAB
    Verification:
    ss -tnp (ESTABLISHED)
    ss -tlnp (LISTEN)
end note

@enduml
