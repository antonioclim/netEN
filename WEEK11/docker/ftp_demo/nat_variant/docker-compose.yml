services:
  ftp:
    image: python:3.12-slim
    working_dir: /app
    volumes:
      - ./ftp:/app
      - ./data:/data
    command: ["python", "ftp_server.py"]
    networks:
      - net_server

  natfw:
    image: debian:stable-slim
    privileged: true
    volumes:
      - ./natfw:/natfw
    command: ["bash", "/natfw/setup.sh"]
    networks:
      - net_client
      - net_server

  client:
    image: python:3.12-slim
    working_dir: /app
    volumes:
      - ./client:/app
    depends_on:
      - natfw
      - ftp
    command: ["python", "ftp_client.py"]
    networks:
      - net_client

networks:
  net_client:
  net_server:
