@startuml fig-docker-compose-lb
'A4 Portrait
skinparam backgroundColor white
skinparam defaultFontName Arial
skinparam defaultFontSize 10
skinparam shadowing false

title Docker Compose Load Balancing Setup

rectangle "Docker Network" as net #F5F5F5 {
    rectangle "nginx\n(load balancer)\n:80" as lb #E3F2FD
    
    rectangle "app (scaled x3)" as apps #E8F5E9 {
        rectangle "app_1\n:8080" as a1 #C8E6C9
        rectangle "app_2\n:8080" as a2 #C8E6C9
        rectangle "app_3\n:8080" as a3 #C8E6C9
    }
}

lb -[#1565C0]-> a1
lb -[#1565C0]-> a2
lb -[#1565C0]-> a3

note right of net
    docker-compose.yml:
    
    services:
      nginx:
        image: nginx
        ports:
          - "80:80"
        volumes:
          - ./nginx.conf:/etc/nginx/nginx.conf
        depends_on:
          - app
    
      app:
        build: ./app
        deploy:
          replicas: 3
    
    Commands:
    docker-compose up -d --scale app=3
    docker-compose ps
    docker-compose logs -f nginx
end note

