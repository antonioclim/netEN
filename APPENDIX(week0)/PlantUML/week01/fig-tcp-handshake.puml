@startuml fig-tcp-handshake
'A4 Portrait - Sequence diagram flows top to bottom
skinparam backgroundColor white
skinparam defaultFontName Arial
skinparam defaultFontSize 11
skinparam shadowing false

skinparam sequence {
    ArrowThickness 2
    ArrowColor #1565C0
    LifeLineBorderColor #1565C0
    LifeLineBackgroundColor #E3F2FD
    ParticipantBorderColor #1565C0
    ParticipantBackgroundColor #BBDEFB
    ParticipantPadding 40
    BoxPadding 20
}

title TCP Three-Way Handshake

participant "Client\n(nc localhost 9999)" as C
participant "Server\n(nc -l -p 9999)" as S

== Connection Establishment ==

C -> S : SYN\nSeq=1000
note right
    Step 1: Client initiates
    SYN flag set
    Initial sequence number
end note

S --> C : SYN-ACK\nSeq=5000, Ack=1001
note left
    Step 2: Server responds
    SYN + ACK flags set
    Acknowledges client seq+1
end note

C -> S : ACK\nSeq=1001, Ack=5001
note right
    Step 3: Client confirms
    ACK flag set
    Connection established
end note

== ESTABLISHED ==

C <-> S : Bidirectional data transfer

== Data Exchange Example ==

C -> S : PSH-ACK "Hello"
S --> C : ACK

S --> C : PSH-ACK "World"
C -> S : ACK

== Verification Commands ==

note over C, S
    ss -tnp | grep 9999
    tcpdump -i lo port 9999
    tshark -i lo -f "port 9999"
end note

@enduml
